<div class="max-w-6xl mx-auto space-y-6">
  <!-- T铆tulo -->
  <div>
    <h2 class="text-lg font-semibold text-slate-900">
      Simulador de Plan de Pagos
    </h2>
    <p class="text-sm text-slate-500">
      Calcula las cuotas de un cr茅dito seg煤n el monto, plazo y tasa de inter茅s.
    </p>
  </div>

  <!-- Formulario de simulaci贸n -->
  <div class="bg-white border border-slate-200 rounded-xl p-4">
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
      <!-- Monto -->
      <div class="space-y-1">
        <label for="amount" class="block text-sm font-medium text-slate-700">
          Monto a solicitar
        </label>
        <input
          id="amount"
          type="number"
          formControlName="amount"
          class="w-full px-3 py-2 rounded-md border text-sm outline-none border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
        />
      </div>

      <!-- Plazo -->
      <div class="space-y-1">
        <label for="termMonths" class="block text-sm font-medium text-slate-700">
          Plazo (meses)
        </label>
        <input
          id="termMonths"
          type="number"
          formControlName="termMonths"
          class="w-full px-3 py-2 rounded-md border text-sm outline-none border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
        />
      </div>

      <!-- Tasa -->
      <div class="space-y-1">
        <label for="annualRate" class="block text-sm font-medium text-slate-700">
          Tasa Anual (ej: 0.18)
        </label>
        <input
          id="annualRate"
          type="number"
          step="0.01"
          formControlName="annualRate"
          class="w-full px-3 py-2 rounded-md border text-sm outline-none border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
        />
      </div>

      <!-- Bot贸n -->
      <button
        type="submit"
        [disabled]="isLoading()"
        class="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-500 disabled:opacity-60 disabled:cursor-not-allowed transition-colors"
      >
        @if (!isLoading()) {
          <span>Simular</span>
        } @else {
          <span class="h-4 w-4 border-2 border-white/50 border-t-transparent rounded-full animate-spin"></span>
          <span>Calculando...</span>
        }
      </button>
    </form>
  </div>

  <!-- Mensaje de error -->
  @if (errorMessage()) {
    <div class="rounded-md bg-rose-50 border border-rose-200 px-3 py-2 text-sm text-rose-700">
      {{ errorMessage() }}
    </div>
  }

  <!-- Resultados de la simulaci贸n -->
  @if (schedule().length > 0) {
    <div class="space-y-4">
      <!-- Resumen de totales y bot贸n de reinicio -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 p-4 bg-white border border-slate-200 rounded-xl">
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
          <div>
            <p class="text-slate-500">Cuota mensual aprox.</p>
            <p class="font-semibold text-lg text-indigo-700">
              {{ schedule()[0].total | currency:'COP':'symbol-narrow':'1.0-0' }}
            </p>
          </div>
          <div>
            <p class="text-slate-500">Total a pagar</p>
            <p class="font-semibold text-slate-800">
              {{ totalPayment | currency:'COP':'symbol-narrow':'1.0-0' }}
            </p>
          </div>
          <div>
            <p class="text-slate-500">Total intereses</p>
            <p class="font-semibold text-slate-800">
              {{ totalInterest | currency:'COP':'symbol-narrow':'1.0-0' }}
            </p>
          </div>
        </div>
        
        <!-- Bot贸n para reiniciar la simulaci贸n -->
        <button 
          type="button" 
          (click)="resetSimulation()"
          class="inline-flex items-center justify-center gap-2 px-3 py-1.5 rounded-md text-xs font-medium text-slate-600 border border-slate-300 hover:bg-slate-100"
        >
          <span></span>
          Nueva simulaci贸n
        </button>
      </div>

      <!-- Tabla de amortizaci贸n -->
      <div class="bg-white border border-slate-200 rounded-xl overflow-hidden">
        <table class="min-w-full text-sm">
          <thead class="bg-slate-50 border-b border-slate-200">
            <tr>
              <th class="px-4 py-2 text-left font-medium text-slate-600"># Cuota</th>
              <th class="px-4 py-2 text-right font-medium text-slate-600">Capital</th>
              <th class="px-4 py-2 text-right font-medium text-slate-600">Inter茅s</th>
              <th class="px-4 py-2 text-right font-medium text-slate-600">Total Cuota</th>
              <th class="px-4 py-2 text-right font-medium text-slate-600">Saldo</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100">
            @for (item of schedule(); track item.installmentNumber) {
              <tr class="hover:bg-slate-50/50">
                <td class="px-4 py-2 text-slate-700">{{ item.installmentNumber }}</td>
                <td class="px-4 py-2 text-right text-slate-800">{{ item.principal | currency:'COP':'symbol-narrow':'1.0-0' }}</td>
                <td class="px-4 py-2 text-right text-slate-800">{{ item.interest | currency:'COP':'symbol-narrow':'1.0-0' }}</td>
                <td class="px-4 py-2 text-right font-semibold text-slate-900">{{ item.total | currency:'COP':'symbol-narrow':'1.0-0' }}</td>
                <td class="px-4 py-2 text-right text-slate-700">{{ item.remainingBalance | currency:'COP':'symbol-narrow':'1.0-0' }}</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }
</div>