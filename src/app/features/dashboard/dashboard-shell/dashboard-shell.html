<div class="min-h-screen flex flex-col bg-slate-50">
    <!-- Header superior -->
    <header
        class="h-18 px-4 md:px-8 flex items-center justify-between border-slate-200 fixed top-0 left-0 right-0 z-50"
        style="background: linear-gradient(180deg, #282f3a 0%, #334155 100%)"
    >
        <div class="flex items-center gap-2">
            <!-- <button (click)="toggleSidebar()" class="text-white p-2 rounded-md hover:bg-slate-700">
                <span class="material-symbols-outlined">menu</span>
            </button>-->
            <button
                type="button"
                class="btn-burguer-ctm text-2xl text-white focus:outline-none cursor-pointer transition-all duration-200 rounded-2xl bg-white/5 hover:bg-white/20 shadow-lg hover:scale-110"
                (click)="toggleSidebar()"
                aria-label="Abrir/cerrar menú"
                style="
                    backdrop-filter: blur(4px);
                    padding: 0.5rem 0.85rem;
                    box-shadow: 0 4px 16px 0 rgba(30, 41, 59, 0.18);
                    border: none;
                "
            >
                <span
                    class="transition-all duration-200 select-none"
                    [ngClass]="sidebarOpen() ? 'rotate-90' : ''"
                    >{{ sidebarOpen() ? '✕' : '☰' }}</span
                >
            </button>
            <div class="flex items-center pl-4">
                <
                <div class="font-semibold text-slate-800 text-base tracking-tight">
                    <span class="text-white pr-1">Tipster</span
                    ><span
                        class="text-slate-500"
                        style="
                            display: inline-block;
                            padding: 3px 10px 3px 5px;
                            background: linear-gradient(90deg, #544ee8 0%, #3b82f6 100%);
                            border-radius: 8px;
                            color: white;
                        "
                        >Bank</span
                    >
                </div>
            </div>
        </div>

        <div class="flex items-center gap-2"></div>

        <!-- Añadimos 'relative' y un ID para el HostListener -->
        <!-- ...existing code... -->
        <div class="relative user-menu-container">
            <app-user-menu
                [userName]="user()?.fullName ?? ''"
                [userEmail]="user()?.email ?? ''"
                [avatarUrl]="user()?.avatarUrl"
                [options]="userMenuOptions"
                [menuOpen]="isUserMenuOpen()"
                (menuOpenChange)="isUserMenuOpen.set($event)"
                (logout)="logout()"
            ></app-user-menu>
        </div>
    </header>

    <!-- Cuerpo: sidebar + contenido -->
    <div class="flex flex-1 pt-20">
        <!-- Contenedor del Sidebar -->
        <!-- En DESKTOP: es visible y empuja el contenido. -->
        <!-- En MÓVIL: está oculto por defecto y se superpone (drawer). -->

        <div
            id="app-sidebar-wrapper"
            class="fixed top-18 bottom-0 left-0 z-40 bg-gradient-to-b from-[#212529] to-[#334155] shadow-xl transition-transform duration-500 ease-in-out will-change-transform md:block backdrop-blur-sm"
            [ngClass]="{
                'translate-x-0': sidebarOpen() || isDesktop(),
                '-translate-x-full': !sidebarOpen() && !isDesktop(),
            }"
        >
            <app-sidebar-menu-ctm
                [isDesktop]="isDesktop()"
                [sidebarOpen]="sidebarOpen()"
                [groups]="groups()"
                [homeLinkSegments]="homeLinkSegments()"
                [flyoutGroup]="flyoutGroup()"
                [activeGroupByUrl]="activeGroupByUrl()"
                (groupClicked)="openGroup($event)"
                (logoutClicked)="logout()"
                (linkClicked)="onLinkClick()"
            ></app-sidebar-menu-ctm>
        </div>

        <!-- El flyout SÓLO se muestra en DESKTOP -->
        @if (isDesktop()) {
            @if (flyoutGroup(); as group) {
                <app-flyout-panel-ctm
                    [group]="group"
                    [sidebarOpen]="sidebarOpen()"
                    (close)="closeFlyout()"
                ></app-flyout-panel-ctm>
            }
        }

        <!-- Contenido Principal con padding dinámico -->
        <main
            class="w-full h-full overflow-y-auto py-6 transition-all duration-300 ease-in-out"
            [ngStyle]="{
                'padding-left': isDesktop() ? (sidebarOpen() ? '18rem' : '2.5rem') : '0',
                'padding-top': '1rem',
            }"
        >
            <!-- 
              Este div ahora solo centra el contenido y da el padding exterior.
              El fondo blanco y padding interior lo dará el PageContainerComponent.
            -->
            <div class="max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8">
                <div class="breadcrumbs-container">
                    <app-breadcrumbs></app-breadcrumbs>
                </div>
                <router-outlet></router-outlet>
            </div>
        </main>
    </div>

    <div class="min-h-screen flex flex-col bg-slate-50">
        <!-- Menú inferior fijo (solo en móviles) -->
        <nav
            class="fixed bottom-0 left-0 right-0 z-50 flex justify-around items-center bg-slate-800 shadow-lg border-t border-slate-700 sm:hidden"
            style="height: 3.5rem"
        >
            <!-- Opción 1: Inicio -->
            <button
                class="flex flex-col items-center justify-center text-slate-300 hover:text-indigo-400 transition"
                aria-label="Inicio"
            >
                <span class="material-symbols-outlined text-xl">home</span>
                <span class="text-[0.7rem] font-medium">Inicio</span>
            </button>

            <!-- Opción 2: Créditos -->
            <button
                class="flex flex-col items-center justify-center text-slate-300 hover:text-indigo-400 transition"
                aria-label="Créditos"
            >
                <span class="material-symbols-outlined text-xl">credit_card</span>
                <span class="text-[0.7rem] font-medium">Créditos</span>
            </button>

            <!-- Opción 3: Perfil -->
            <button
                class="flex flex-col items-center justify-center text-slate-300 hover:text-indigo-400 transition"
                aria-label="Perfil"
            >
                <span class="material-symbols-outlined text-xl">person</span>
                <span class="text-[0.7rem] font-medium">Perfil</span>
            </button>
        </nav>
    </div>

    <footer
        class="w-full border-t border-slate-200 py-3 px-4"
        style="background: linear-gradient(90deg, #282f3a 0%, #334155 100%)"
    >
        <div
            class="max-w-3xl mx-auto flex flex-col md:flex-row items-center justify-center gap-2 md:gap-8 text-xs text-slate-200 text-center"
        >
            <div class="flex items-center gap-2">
                <span
                    class="inline-flex items-center justify-center h-7 w-7 rounded-full shadow border-1"
                    style="border-color: #fff; background: transparent"
                >
                    <img src="assets/jd.png" alt="Logo Jaime Díaz" class="h-5 w-5 object-contain" />
                </span>
                <span class="font-semibold text-white">Jaime Díaz</span>
            </div>
            <div>
                <a
                    href="https://jaimediaz.dev"
                    target="_blank"
                    rel="noopener"
                    class="hover:text-emerald-400 transition underline underline-offset-2"
                    >jaimediaz.dev</a
                >
            </div>
            <div>© {{ today | date: 'yyyy' }}. Todos los derechos reservados.</div>
        </div>
    </footer>
</div>
