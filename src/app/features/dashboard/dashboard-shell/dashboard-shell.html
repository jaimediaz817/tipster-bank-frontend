<div class="min-h-screen flex flex-col bg-slate-50">
    <!-- Header superior -->
    <header
        class="h-20 px-4 md:px-8 flex items-center justify-between border-b border-slate-200 fixed top-0 left-0 right-0 bg-white z-50"
        style="background-color: #282f3a"
    >
        <div class="flex items-center gap-2">
            <!-- <button (click)="toggleSidebar()" class="text-white p-2 rounded-md hover:bg-slate-700">
                <span class="material-symbols-outlined">menu</span>
            </button>-->
            <button
                type="button"
                class="text-2xl text-slate-600 focus:outline-none cursor-pointer mx-right"
                (click)="toggleSidebar()"
                aria-label="Abrir/cerrar menú"
            >
                <span class="text-white">{{ sidebarOpen() ? '✕' : '☰' }}</span>
            </button>
            <div class="flex items-center pl-4">
                <div
                    class="flex items-center justify-center h-8 w-8 rounded-full bg-indigo-600 text-white font-bold text-sm"
                >
                    T
                </div>
                <div class="font-semibold text-slate-800 text-base tracking-tight">
                    <span class="text-white pr-1">Tipster</span
                    ><span class="text-slate-500">Bank</span>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-2"></div>
        <!-- Zona derecha del header (dashboard-shell.html) -->
        <div
            class="flex items-center gap-3 px-3 py-1 rounded-full bg-white/80 border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer max-w-xs sm:max-w-none"
            style="backdrop-filter: blur(2px)"
        >
            <span
                class="material-icons text-indigo-600 bg-indigo-100 rounded-full border border-indigo-200 p-1 text-lg"
                >person</span
            >
            <div class="flex flex-col leading-tight min-w-0">
                <span
                    class="text-sm font-semibold text-slate-800 truncate max-w-[120px] sm:max-w-none"
                >
                    {{ user()?.fullName ?? 'Usuario' }}
                </span>
                <span class="text-xs text-slate-500 truncate">
                    {{
                        user()?.roles?.[0] === 'ROLE_ANALISTA'
                            ? 'Analista'
                            : user()?.roles?.[0] === 'ROLE_ADMIN'
                              ? 'Admin'
                              : 'Cliente'
                    }}
                </span>
            </div>
            <button
                class="logout-btn flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium text-slate-500 hover:bg-red-50 hover:text-red-600 border border-transparent hover:border-red-200 transition"
                (click)="logout()"
                aria-label="Cerrar sesión"
            >
                <span class="material-icons text-base">logout</span>
                <span class="hidden sm:inline">Salir</span>
            </button>
        </div>
    </header>

    <!-- Cuerpo: sidebar + contenido -->
    <div class="flex flex-1 pt-20">

   
        <!-- Contenedor del Sidebar -->
        <!-- En DESKTOP: es visible y empuja el contenido. -->
        <!-- En MÓVIL: está oculto por defecto y se superpone (drawer). -->
        <div
            id="app-sidebar-wrapper"
            class="fixed top-20 bottom-0 left-0 z-40 transition-transform duration-300 ease-in-out md:block"
            [ngClass]="{
                'translate-x-0': sidebarOpen() || isDesktop(),
                '-translate-x-full': !sidebarOpen() && !isDesktop()
            }"
        >
            <app-sidebar-menu-ctm
                [sidebarOpen]="sidebarOpen()"
                [groups]="groups()"
                [homeLinkSegments]="homeLinkSegments()"
                [flyoutGroup]="flyoutGroup()"
                [activeGroupByUrl]="activeGroupByUrl()"
                (groupClicked)="openGroup($event)"
                (logoutClicked)="logout()"
            ></app-sidebar-menu-ctm>
        </div>

        @if (flyoutGroup(); as group) {
            <app-flyout-panel-ctm
                [group]="group"
                [sidebarOpen]="sidebarOpen()"
                (close)="closeFlyout()"
            ></app-flyout-panel-ctm>
        }

        <!-- Contenido Principal con padding dinámico -->
        <main
            class="h-full overflow-y-auto py-6 transition-all duration-300 ease-in-out"
            [ngStyle]="{
                'padding-left': isDesktop() ? (sidebarOpen() ? '18rem' : '5rem') : '0',
                'padding-top': '5rem',
            }"
        >
            <!--  TODO: PADING EN EL CONTENIDO CONCRETO sm:px-6 md:px-8 -->
            <div class="max-w-7xl mx-auto w-full px-4">
                <div class="breadcrumbs-container">
                    <app-breadcrumbs></app-breadcrumbs>
                </div>
                <router-outlet></router-outlet>
            </div>
        </main>
    </div>

    <footer
        class="w-full border-t border-slate-200 py-3 px-4"
        style="background: linear-gradient(90deg, #282f3a 0%, #334155 100%)"
    >
        <div
            class="max-w-3xl mx-auto flex flex-col md:flex-row items-center justify-center gap-2 md:gap-8 text-xs text-slate-200 text-center"
        >
            <div class="flex items-center gap-2">
                <span
                    class="inline-flex items-center justify-center h-7 w-7 rounded-full shadow border-1"
                    style="border-color: #fff; background: transparent"
                >
                    <img src="assets/jd.png" alt="Logo Jaime Díaz" class="h-5 w-5 object-contain" />
                </span>
                <span class="font-semibold text-white">Jaime Díaz</span>
            </div>
            <div>
                <a
                    href="https://jaimediaz.dev"
                    target="_blank"
                    rel="noopener"
                    class="hover:text-emerald-400 transition underline underline-offset-2"
                    >jaimediaz.dev</a
                >
            </div>
            <div>© {{ today | date: 'yyyy' }}. Todos los derechos reservados.</div>
        </div>
    </footer>
</div>
