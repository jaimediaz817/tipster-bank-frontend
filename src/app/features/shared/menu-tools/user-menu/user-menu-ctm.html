<div class="relative border-2 border-white/15 rounded-full">
    <!-- Botón de usuario -->
    <button
        class="user-menu-trigger flex items-center gap-2 px-1 py-1 rounded-full hover:bg-slate-100/10 transition"
        (click)="toggleMenu()"
        aria-haspopup="true"
        aria-expanded="{{ menuOpen }}"
        type="button"
    >
        @if (avatarUrl) {
            <img
                [src]="avatarUrl"
                alt="Avatar"
                class="w-9 h-9 rounded-full object-cover border border-slate-200"
            />
        } @else {
            <span
                class="w-9 h-9 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold text-lg"
            >
                {{ userName ? userName[0] : '?' }}
            </span>
        }
        <span class="hidden md:block text-sm font-semibold text-white">{{ userName }}</span>
        <span
            class="material-symbols-outlined text-white transition-transform duration-200"
            [ngClass]="{ 'rotate-180': menuOpen }"
        >
            expand_more
        </span>
    </button>

    <!-- Dropdown -->

    @if (menuOpen) {
        <div
            class="user-menu-dropdown custom-dropdown absolute right-0 mt-2 z-50 user-menu-dropdown absolute right-0 mt-2 w-[90vw] max-w-xs sm:w-80 sm:max-w-full bg-white rounded-xl shadow-lg border border-slate-200 z-50"
        >
            <!-- Header personalizado -->
            <div
                class="dropdown-header flex justify-between items-center px-4 py-2 border-b border-slate-100 bg-slate-50 rounded-t-xl"
            >
                <!-- filepath: credit-platform-frontend/src/app/features/shared/menu-tools/user-menu/user-menu-ctm.html -->
                <span class="text-sm font-medium text-slate-500 select-none"
                    >Opciones de mi cuenta</span
                >
                <button
                    class="btn-close-dropdown-ctm icon-btn p-1 rounded-full hover:bg-slate-100 transition focus:outline-none"
                    (click)="toggleMenu()"
                    aria-label="Cerrar menú"
                    type="button"
                >
                    <span class="material-symbols-outlined text-slate-500 text-lg">close</span>
                </button>
            </div>

            <!--<div class="px-4 py-3 border-b border-slate-100">
                <div class="font-semibold text-slate-800">{{ userName }}</div>
                <div class="text-xs text-slate-500 truncate">{{ userEmail }}</div>
            </div>-->

            <div class="user-data-container-ctm px-4 py-3 border-b border-slate-100 bg-white/80 rounded-b-lg shadow-inner">
                <div class="font-semibold text-slate-800 text-base leading-tight mb-0.5 truncate">
                    {{ userName }}
                </div>
                <div class="text-xs text-slate-400 truncate">{{ userEmail }}</div>
            </div>

            <ul class="dropdown-menu-container py-2">
                @for (option of options; track option) {
                    @if (option.dividerAbove) {
                        <li class="my-1 border-t border-slate-300"></li>
                    }
                    <li class="dd-menu-item-ctm">
                        @if (option.routerLink) {
                            <a
                                [routerLink]="option.routerLink"
                                (click)="onOptionClick(option)"
                                class="flex items-center gap-2 px-4 py-2 text-sm transition hover:bg-indigo-600 hover:text-white"
                                [ngClass]="{ 'text-rose-600 font-semibold': option.danger }"
                            >
                                @if (option.icon) {
                                    <span class="material-symbols-outlined">{{ option.icon }}</span>
                                }
                                {{ option.label }}
                            </a>
                        } @else {
                            <button
                                (click)="onOptionClick(option)"
                                class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm transition hover:bg-indigo-600 hover:text-white"
                                [ngClass]="{ 'text-rose-600 font-semibold': option.danger }"
                                type="button"
                            >
                                @if (option.icon) {
                                    <span class="material-symbols-outlined">{{ option.icon }}</span>
                                }
                                {{ option.label }}
                            </button>
                        }
                    </li>
                }
                <li>
                    <button
                        class="btn-cerrar-sesion-ctm w-full flex items-center gap-2 px-4 py-2 text-sm text-slate-700 font-semibold rounded-b-xl transition border-t border-slate-200 bg-slate-200 hover:text-white hover:bg-gradient-to-r hover:from-rose-400 hover:to-pink-500 hover:shadow-lg"
                        style="
                            transition:
                                background 0.3s,
                                color 0.3s;
                        "
                        (click)="onLogoutClick()"
                        type="button"
                    >
                        <span class="material-icons">logout</span>
                        <span>Cerrar sesión</span>
                    </button>
                </li>
            </ul>
        </div>
    }
</div>
